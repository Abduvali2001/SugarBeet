<html>
<head>
    <title>Page Title</title>
    <meta charset="utf-8">
    <meta content='height=device-height, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <link rel="stylesheet" href="../../lib/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="../../lib/css/jquery.mobile-1.4.5.min.css" />
    <link rel='stylesheet' media='screen and (max-width: 400px)' href='../../lib/css/narrow.css' />
    <link rel='stylesheet' media='screen and (min-width: 401px) and (max-width: 700px)' href='../../lib/css/medium.css' />
    <link rel='stylesheet' media='screen and (min-width: 701px)' href='../../lib/css/wide.css' />
    <link rel="stylesheet" href="../../lib/css/style.css"/>
    <link rel="stylesheet" href="../../lib/css/sprites.css"/>
    <script src="../../lib/js/jquery-1.11.1.min.js"></script>

    <script src="../../lib/js/jquery.mobile-1.4.5.min.js"></script>

    <script src="../../lib/js/bootstrap.min.js"></script>
    <script src="../../lib/js/myscript.js"></script>
</head>

<body>
<div data-role="page" id="pricepage" data-dom-cache="false">

    <div data-role="header" id="header" data-tap-toggle="false" data-position="fixed">
        <a data-rel="back" class="ui-btn-left ui-btn ui-icon-back ui-btn-icon-notext ui-shadow ui-corner-all" data-role="button" role="button">Back</a>
        <a href="../index.html" class="ui-icon-home" data-icon="home" data-iconpos="notext">Menu</a>
        <h1>Weather</h1>
    </div><!-- /header -->

    <div role="main" class="ui-content">

        <button id="send_weather" class="ui-btn ui-corner-all">Show the weather</button>

        <div id="weather" style="margin-top: 10px;"></div>

        <div data-role="collapsibleset">
            <div data-role="collapsible" data-inset="true">
                <h4>Tajikistan</h4>
                <ul data-role="listview" class="city_list">
                    <li class="oblast_list">
                        <div data-role="collapsible" data-inset="true">
                            <h4>Sughd</h4>
                            <ul data-role="listview">
                                <li><label><input type='checkbox' name='city' value='1' /> Ayni</label></li>
                                <li><label><input type='checkbox' name='city' value='2' /> Asht</label></li>
                                <li><label><input type='checkbox' name='city' value='3' /> B.Gafurov</label></li>
                                <li><label><input type='checkbox' name='city' value='5' /> Mastchohi Kuhi</label></li>
                                <li><label><input type='checkbox' name='city' value='4' /> Devashtich</label></li>
                                <li><label><input type='checkbox' name='city' value='6' /> J.Rasulov</label></li>
                                <li><label><input type='checkbox' name='city' value='7' /> Zafarobod</label></li>
                                <li><label><input type='checkbox' name='city' value='8' /> Istaravshan</label></li>
                                <li><label><input type='checkbox' name='city' value='9' /> Isfara</label></li>
                                <li><label><input type='checkbox' name='city' value='10' /> Konibodom</label></li>
                                <li><label><input type='checkbox' name='city' value='11' /> Mastchoh</label></li>
                                <li><label><input type='checkbox' name='city' value='12' /> Panjakent</label></li>
                                <li><label><input type='checkbox' name='city' value='13' /> Spitamen</label></li>
                                <li><label><input type='checkbox' name='city' value='15' /> Khujand</label></li>
                                <li><label><input type='checkbox' name='city' value='16' /> Chkalovsk</label></li>
                                <li><label><input type='checkbox' name='city' value='14' /> Shahriston</label></li>
                            </ul>
                        </div>
                    </li>
                    <li class="oblast_list">
                        <div data-role="collapsible" data-inset="true">
                            <h4>DRS</h4>
                            <ul data-role="listview">
                                <li><label><input type='checkbox' name='city' value='42' /> Varzob</label></li>
                                <li><label><input type='checkbox' name='city' value='43' /> Vahdat</label></li>
                                <li><label><input type='checkbox' name='city' value='44' /> Gissar</label></li>
                                <li><label><input type='checkbox' name='city' value='45' /> Jirgatol</label></li>
                                <li><label><input type='checkbox' name='city' value='55' /> Dushanbe</label></li>
                                <li><label><input type='checkbox' name='city' value='46' /> Nurobod</label></li>
                                <li><label><input type='checkbox' name='city' value='47' /> Rasht</label></li>
                                <li><label><input type='checkbox' name='city' value='48' /> Rogun</label></li>
                                <li><label><input type='checkbox' name='city' value='49' /> Rudaki</label></li>
                                <li><label><input type='checkbox' name='city' value='50' /> Tavildara</label></li>
                                <li><label><input type='checkbox' name='city' value='51' /> Tojikobod</label></li>
                                <li><label><input type='checkbox' name='city' value='52' /> Tursunzoda</label></li>
                                <li><label><input type='checkbox' name='city' value='53' /> Fayzobod</label></li>
                                <li><label><input type='checkbox' name='city' value='54' /> Shahrinav</label></li>
                            </ul>
                        </div>
                    </li>
                    <li class="oblast_list">
                        <div data-role="collapsible" data-inset="true">
                            <h4>Khatlon</h4>
                            <ul data-role="listview">
                                <li><label><input type='checkbox' name='city' value='17' /> A.Jomi</label></li>
                                <li><label><input type='checkbox' name='city' value='18' /> Baljuvon</label></li>
                                <li><label><input type='checkbox' name='city' value='41' /> Bokhtar</label></li>
                                <li><label><input type='checkbox' name='city' value='20' /> Vakhsh</label></li>
                                <li><label><input type='checkbox' name='city' value='21' /> Vose</label></li>
                                <li><label><input type='checkbox' name='city' value='22' /> Danghara</label></li>
                                <li><label><input type='checkbox' name='city' value='23' /> J.Rumi</label></li>
                                <li><label><input type='checkbox' name='city' value='24' /> Jilikul</label></li>
                                <li><label><input type='checkbox' name='city' value='25' /> Kubodiyon</label></li>
                                <li><label><input type='checkbox' name='city' value='26' /> Kulob</label></li>
                                <li><label><input type='checkbox' name='city' value='27' /> Kumsangir</label></li>
                                <li><label><input type='checkbox' name='city' value='19' /> Kushoniyon</label></li>
                                <li><label><input type='checkbox' name='city' value='33' /> Levakand</label></li>
                                <li><label><input type='checkbox' name='city' value='28' /> Muminobod</label></li>
                                <li><label><input type='checkbox' name='city' value='29' /> N.Khisrav</label></li>
                                <li><label><input type='checkbox' name='city' value='30' /> Norak</label></li>
                                <li><label><input type='checkbox' name='city' value='31' /> Parkhar</label></li>
                                <li><label><input type='checkbox' name='city' value='32' /> Panj</label></li>
                                <li><label><input type='checkbox' name='city' value='34' /> Temurmalik</label></li>
                                <li><label><input type='checkbox' name='city' value='35' /> Hamadoni</label></li>
                                <li><label><input type='checkbox' name='city' value='36' /> Khovaling</label></li>
                                <li><label><input type='checkbox' name='city' value='37' /> Khuroson</label></li>
                                <li><label><input type='checkbox' name='city' value='38' /> Shahritus</label></li>
                                <li><label><input type='checkbox' name='city' value='39' /> Shurobod</label></li>
                                <li><label><input type='checkbox' name='city' value='40' /> Yovon</label></li>
                            </ul>
                        </div>
                    </li>
                    <li class="oblast_list">
                        <div data-role="collapsible" data-inset="true">
                            <h4>GBAR</h4>
                            <ul data-role="listview">
                                <li><label><input type='checkbox' name='city' value='57' /> Vanj</label></li>
                                <li><label><input type='checkbox' name='city' value='56' /> Darvoz</label></li>
                                <li><label><input type='checkbox' name='city' value='61' /> Ishkoshim</label></li>
                                <li><label><input type='checkbox' name='city' value='60' /> Roshtkala</label></li>
                                <li><label><input type='checkbox' name='city' value='58' /> Rushon</label></li>
                                <li><label><input type='checkbox' name='city' value='63' /> Khorog</label></li>
                                <li><label><input type='checkbox' name='city' value='59' /> Shughnon</label></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>
            <div data-role="collapsible" data-inset="true">
                <h4>Kyrgyztan</h4>
                <ul data-role="listview" class="city_list">
                    <li class="oblast_list">
                        <div data-role="collapsible" data-inset="true">
                            <h4>Batken</h4>
                            <ul data-role="listview">
                                <li><label><input type='checkbox' name='city' value='64' /> Batken</label></li>
                                <li><label><input type='checkbox' name='city' value='119' /> Leilek</label></li>
                                <li><label><input type='checkbox' name='city' value='120' /> Kadamzhai</label></li>
                            </ul>
                        </div>
                    </li>
                    <li class="oblast_list">
                        <div data-role="collapsible" data-inset="true">
                            <h4>Jalal-Abad</h4>
                            <ul data-role="listview">
                                <li><label><input type='checkbox' name='city' value='67' /> Aksy</label></li>
                                <li><label><input type='checkbox' name='city' value='68' /> Ala-Bukinsky</label></li>
                                <li><label><input type='checkbox' name='city' value='69' /> Bazar-Korgon</label></li>
                                <li><label><input type='checkbox' name='city' value='111' /> Jalal-Abad</label></li>
                                <li><label><input type='checkbox' name='city' value='75' /> Astrakhan</label></li>
                                <li><label><input type='checkbox' name='city' value='121' /> Nooken</label></li>
                                <li><label><input type='checkbox' name='city' value='71' /> Suzak</label></li>
                                <li><label><input type='checkbox' name='city' value='77' /> Tash-Kumyr</label></li>
                                <li><label><input type='checkbox' name='city' value='122' /> Toguz-Toro</label></li>
                                <li><label><input type='checkbox' name='city' value='73' /> Toktogul</label></li>
                                <li><label><input type='checkbox' name='city' value='74' /> Chatkal</label></li>

                            </ul>
                        </div>
                    </li>
                    <li class="oblast_list">
                        <div data-role="collapsible" data-inset="true">
                            <h4>Issyk-Kul</h4>
                            <ul data-role="listview">
                                <li><label><input type='checkbox' name='city' value='78' /> Ak-Suu</label></li>
                                <li><label><input type='checkbox' name='city' value='83' /> Balykchy</label></li>
                                <li><label><input type='checkbox' name='city' value='79' /> Jeti-Oguz</label></li>
                                <li><label><input type='checkbox' name='city' value='80' /> Issyk-Kul</label></li>
                                <li><label><input type='checkbox' name='city' value='84' />Karakol </label></li>
                                <li><label><input type='checkbox' name='city' value='81' /> Tonsky</label></li>
                                <li><label><input type='checkbox' name='city' value='82' /> Tyupsky</label></li>

                            </ul>
                        </div>
                    </li>
                    <li class="oblast_list">
                        <div data-role="collapsible" data-inset="true">
                            <h4>Naryn</h4>
                            <ul data-role="listview">
                                <li><label><input type='checkbox' name='city' value='85' />Ak-Talinsky</label></li>
                                <li><label><input type='checkbox' name='city' value='86' /> At-Bashinsky</label></li>
                                <li><label><input type='checkbox' name='city' value='88' /> Kochkor</label></li>
                                <li><label><input type='checkbox' name='city' value='112' /> Jumgalsky</label></li>
                                <li><label><input type='checkbox' name='city' value='89' />Naryn</label></li>
                            </ul>
                        </div>
                    </li>
                    <li class="oblast_list">
                        <div data-role="collapsible" data-inset="true">
                            <h4>Osh</h4>
                            <ul data-role="listview">
                                <li><label><input type='checkbox' name='city' value='90' /> Alai</label></li>
                                <li><label><input type='checkbox' name='city' value='91' /> Aravan</label></li>
                                <li><label><input type='checkbox' name='city' value='110' /> Osh</label></li>
                                <li><label><input type='checkbox' name='city' value='92' /> Kara-Kulzhinsky</label></li>
                                <li><label><input type='checkbox' name='city' value='93' /> Kara-Suu</label></li>
                                <li><label><input type='checkbox' name='city' value='123' /> Nookat</label></li>
                                <li><label><input type='checkbox' name='city' value='95' /> Uzgen</label></li>
                                <li><label><input type='checkbox' name='city' value='124' /> Chon-Alai</label></li>
                            </ul>
                        </div>
                    </li>
                    <li class="oblast_list">
                        <div data-role="collapsible" data-inset="true">
                            <h4>Talas</h4>
                            <ul data-role="listview">
                                <li><label><input type='checkbox' name='city' value='97' /> Bakai-Ata</label></li>
                                <li><label><input type='checkbox' name='city' value='100' /> Talas</label></li>
                                <li><label><input type='checkbox' name='city' value='113' /> Kara-Buurinsky</label></li>
                                <li><label><input type='checkbox' name='city' value='114' />Manas</label></li>
                            </ul>
                        </div>
                    </li>
                    <li class="oblast_list">
                        <div data-role="collapsible" data-inset="true">
                            <h4>Chui</h4>
                            <ul data-role="listview">
                                <li><label><input type='checkbox' name='city' value='115' />Alamedinskiy</label></li>
                                <li><label><input type='checkbox' name='city' value='109' /> Bishkek</label></li>
                                <li><label><input type='checkbox' name='city' value='116' />Zhaiylsky</label></li>
                                <li><label><input type='checkbox' name='city' value='117' />Keminsky</label></li>
                                <li><label><input type='checkbox' name='city' value='118' />Moscow</label></li>
                                <li><label><input type='checkbox' name='city' value='105' /> Panfilovsky</label></li>
                                <li><label><input type='checkbox' name='city' value='106' /> Sokuluk</label></li>
                                <li><label><input type='checkbox' name='city' value='107' /> Chui</label></li>
                                <li><label><input type='checkbox' name='city' value='108' />Ysyk-Ata</label></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

    </div><!-- /content -->

    <div data-role="footer" id="footer" data-tap-toggle="false" data-position="fixed">
        <h4></h4>
    </div><!-- /footer -->

    <script type="text/javascript">
        //$(function(){
        //$(document).ready(function(){
        $(document).on("pageshow", function(){
            $(function(){
                $( "#send_weather" ).bind( "click", function(event, ui) {

                    event.preventDefault();
                    var cityArray = $('input:checked').map(function(){                      // get checked into array
                        return $(this).val();
                    }).get();

                    cityArray = (cityArray != "") ? cityArray : "all";                      // if checked checkbox get as array, else "all"

                    $.ajax({
//                        url:"http://192.168.0.60/android/helvetas.php",
                        url:"http://data.agroinform.asia/api/get-weather/",
                        timeout: 30000, //30 секунд
                        data: {
                            weather: "mWeatherLastDay",
                            lang: "ru",
                            city: cityArray
                        },
                        type:'GET',
                        dataType: 'jsonp',
                        crossDomain: true,
                        jsonp:"mycallback",
                        beforeSend: function( xhr ) {
                            $( "#weather").html("<p style='text-align: center;'><img src='../../lib/css/images/ajax-loader.gif' height='20' align='center'/> Подождите, идёт загрузка...</p>");
                        },
                        success: function(data){
                            /*console.log("test="+data);
                             var msg = jQuery.parseJSON(data);
                             console.log("test="+msg[0]);
                             $( "#weather").html(msg);*/
                            alert("Name:"+data.name);
                        },
                        error: function(jqXHR, textStatus){
                            if (textStatus=='timeout'){
                                $( "#weather").html("<p style='text-align: center;'>Сервер не доступен или проверьте ваше подключение к Интернету. Попробуйте позже, пожалуйста!</p>");
                            }
                            //alert('error='+textStatus);
                            //msg = jQuery.parseJSON(data);
                            //alert('Failed!='+ data);
                        }
                    });
                });
            });

        });


        function mycallback(data)
        {
            $( "#weather").html(data);
            //alert("Here: "+data.name);
        }

    </script>

</div><!-- /page -->
</body>
</html>
